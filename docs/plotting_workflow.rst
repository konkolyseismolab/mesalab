.. _plotting_workflow:

Plotting Workflow
=================

The Plotting workflow in ``mesalab`` is dedicated to generating various insightful visualizations from your processed MESA simulation data. It takes the structured output of the MESA Run Analysis and translates it into publication-ready plots.

Purpose
-------

This workflow automates the creation of:

* **Hertzsprung-Russell (HR) Diagrams:** Visualize stellar evolutionary tracks, often with color-coded phases (e.g., ZAMS, TAMS, He-burning) and markers for specific events (e.g., instability strip crossings, blue loop turning points).
* **Instability Strip Plots / Heatmaps:** Display the distribution of instability strip crossings across your grid of models, providing a clear overview of pulsational behavior trends. This can be particularly powerful for analyzing large parameter spaces.
* **Blue Loop Visualizations:** Highlight the characteristics and extent of blue loops on the HR diagram for selected models.
* **Additional Plots:** Depending on ``mesalab``'s capabilities, this could include other types of plots such as internal structure profiles, chemical abundance maps, or rotation rate evolution. (Adjust this based on what mesalab *actually* plots).

Input
-----

The primary input for the Plotting workflow is the summarized data generated by the `MESA Run Analysis Workflow <./mesa_analysis_workflow.rst>`_, typically the `summary_data.csv` file.

* **Implicit Input Path:** ``mesalab`` will automatically look for the necessary input data in the **``analysis_results``** directory (which is typically located inside your main ``output_dir`` of the previous `mesalab` run). Ensure this directory contains the `summary_data.csv` (or the custom filename you've set).

Output
------

All generated plots are saved to the **``plots``** subdirectory within your `mesalab` session's main `output_dir`. The specific filenames and formats are configurable.

* **Image Files:** Plots are saved in common image formats such as PNG, PDF, or SVG, as specified in the configuration.
    * Example filenames: `HR_diagram_all_models.png`, `InstabilityStrip_Heatmap.pdf`, `BlueLoop_model_X.svg`.

Configuration Parameters
------------------------

The Plotting workflow's behavior is controlled by parameters within the `plotting_workflow` section of your `YAML configuration file <./yaml_config.rst>`_.

* **``run_plotting_workflow``**: (Boolean) Set to `true` to enable this workflow. Default: `true`.
* **``plots_to_generate``**: (List of Strings) A list specifying which types of plots to create. Common options include:
    * ``hr_diagrams``
    * ``instability_strip_heatmap``
    * ``blue_loop_plots``
    * (Add other specific plot types your `mesalab` supports)
* **``plot_output_format``**: (String) The desired file format for the generated plots (e.g., `png`, `pdf`, `svg`). Default: `png`.
* **``hr_diagram_settings``**: (Dictionary) Specific settings for HR diagrams, such as axis ranges, color coding, labels, and marker styles.
* **``instability_strip_settings``**: (Dictionary) Settings related to the instability strip heatmap, e.g., grid resolution, color maps.
* **``blue_loop_settings``**: (Dictionary) Settings for blue loop visualizations, e.g., how blue loops are highlighted.
* **``use_holoviews_for_interactive_plots``**: (Boolean) If `true` and `Holoviews` is installed, `mesalab` attempts to generate interactive plots using Holoviews. If `Holoviews` is not installed, a warning will be issued, and static plots will be generated instead (if `Matplotlib` is the fallback). Refer to `Missing Optional Dependencies (Holoviews, PyMultiNest) <./troubleshooting.rst#missing-optional-dependencies-holoviews-pymultinest>`_ for installation instructions.

For a complete list of parameters and their detailed descriptions, please refer to the `Understanding the YAML Configuration <./yaml_config.rst>`_ section.

Running this Workflow Independently
-----------------------------------

You can choose to run *only* the Plotting workflow if you already have the processed data from a previous MESA Run Analysis (e.g., `summary_data.csv` in your `analysis_results` directory) and wish to generate plots without re-running the analysis. This is useful for iterating on plotting parameters or creating new visualizations from existing data.

To run only this part, ensure your YAML configuration file has:

.. code-block:: yaml

    mesa_analysis_workflow:
      run_mesa_analysis_workflow: false # Disable MESA analysis
      # Ensure mesa_runs_base_dir is still correctly pointing to your MESA outputs
      # even if not running analysis, as it might be used for context or default paths.

    plotting_workflow:
      run_plotting_workflow: true # Enable plotting
      # ... (other plotting settings)

    gyre_workflow:
      run_gyre_workflow: false # Disable GYRE

Then, execute ``mesalab`` as usual:

.. code-block:: bash

    mesalab --config path/to/your_config_settings.yaml

``mesalab`` will automatically look for the necessary `summary_data.csv` (and any other required analysis output) in the `analysis_results` directory of your `output_dir`.